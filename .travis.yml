#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

sudo: required
dist: xenial
jdk: openjdk8
language: java
services:
  - docker

notifications:
  email: false
  webhooks:
    urls:
      # travis2slack webhook to enable DMs on openwhisk-team.slack.com to PR authors with TravisCI results
      secure: "C+xu3CoAqyHm8N8zVwjOGhZOxYmwjZRkBMZUAbiNz6vVZq6j/TU8Mu44Z5zEWsufSdrAtu+Mg4Kfr00x8hlYYBxH6YXs7vKhToCERY1JLnlSjquvzzbOkaiG+fpYyiATNH6uz1BJdm1FcSr8n2mRV1nmAXmE/Ie28Q+nVIFt8CXA/mBWl9Z/l6Rwf7REWgWL4mGr2Wjb3vgth0IEO7rZtDKxQlas0s8naJA6nA6dIPxBFuuBrLmNIRAF7qOLBLC6508UWqt+9k/QYbujM7qhnmSJEPGHXG/5lZBWbn2UPIS6EKTlYW5o44cGmP8N0MAKDJezmDjE4r8HwTiKzaM8axQPLw+H7wumhIXbPO2lsHGgzxZAh7M771cXf8pRxoaqWm/bxweAPWA+6bKSrHJGYtM9FTHghNVeuwLTR18NJj4mIzb9BS90rodLfLXrbUPY5lC/4I5YRrCqlhyHr7aibWXM27ehf5/ujkQkBSyd6LeiONl04jFcCNPHlYxIf2XJnHX/6CiE/eJ2R7xqwtGBkTXCb63hnOqDv49nDrj0PfPi2Y0B4x/zoXz6P7ZyogDM6dOOUeL2u/XBryJgQxnoH2S+7Gh+qSdAigCsD2onsF6ghHCdeQRVX/f7CHsyXVxqxHdfyXNXrJJ1uz0tVKZkNSSOwU/1JJbiA+wzGYTnu3E="

before_install:
  - "./tools/travis/setup.sh"
install: true
script:
  - "./tools/travis/build.sh && ./tools/travis/test.sh"
deploy:
  - provider: script
    script: "./tools/travis/publish.sh openwhisk ${TRAVIS_TAG%@*} ${TRAVIS_TAG##*@}"
    on:
      tags: true
      all_branches: true
      repo: apache/openwhisk-runtime-nodejs
  - provider: script
    script: "./tools/travis/publish.sh openwhisk nodejs12Action nightly && ./tools/travis/publish.sh openwhisk nodejs14Action nightly && ./tools/travis/publish.sh openwhisk typescript37Action nightly"
    on:
      branch: master
      repo: apache/openwhisk-runtime-nodejs

env:
  global:
  - secure: "HybKV5P/l7E0z92qkx4lRU0dtBDEVV2TCwwVFbWA30vmJCts3E/RUZbJOGLGdIqw4VRN4xA1F6b5aORF6ah/oNDOOiwYJweL/zQO7gwKwy3WU0wMA0pJ0OHoRNNuPO6vRZCiPtHJA1qyhF0cWsq0wZxKLuSU6fhctWAdYOQSwyNf6ljWGHkEKHGXW86UE/x83VrA3Ch6JC+MZLoSmZEMrvSNQtzbgVK+WUYweqx9pFu7jiYTZ1PnU2HKjMjrB/9s/yHuWVCNP+R7MabCH4dKBzAEHo+95dSXAJppVn7zxtnMGcvzzv+At3ODdA3VifTe4EbTMTK6x3LQc59wkUlZYxWtWUhUth9mdwEmHOp7IlqAQCiBN9HFd9yxGs2rhF4VlMJtqpa3iHZpx/sdce3ihsue+O1NYBgSEodPG0YJjYouQxGPHcdTCkwxUSzhFC/zsKGuPAB/pj79nY9AXUuA72vzpFm89zDCgEz1uDgu/9dtm4xoGm4IwhP0M50QLyk1N1hNEjhfQpX6biwZrGYMj9GxehkTurbIhcdSriY9iRGokljL3mVnJu0PRJuUNMiUFZAaDA3SnmMbrNZ5LgLrrUebPju/5ulF2RsAvcdsQQ106dJ/fLZgwt0oXsOD0uHuNUC1XY/acCI8sEmKGmjWldgImLmoifeP627DNbreaq0="
  - secure: "aqonrFEze66WvQfLjeM8rbR0ylHalPCLV2kSxO7YstA5fRhpeOwI8kK2OjXi6bxLQ8ETFuV4iF57un8WcGcDYb4eLxQVnBFKb8ckHvddevsKpi2DWAQ/77krmGQ8BOjZFBKMy7hEAKrS9HlUyeJwC0nzYEv5GG2P58G1+v4PypVOdE5mWfhmuS2a60cHfBkcIfeFX+r0xOiIRZAhbrB1hjQLAzHZmfzEo38wk9n3NNy2kGSoIkk2Hy22uu4QVW9oM4Qo2+UFqbtIQ8dOHZS1WeDbdugKtF8SXT1yK+D9PKr1IDxVubutyXqdi91vqyb6YXFY7SaspMJt506EjREIZOUbZDQXS+jGL+J9/N1lm5IoWvIaqTk3jEI+WFMzDt62mSXf4aqbm6fb2li1RuBpcPnLc7gl7WX8De0nanNKlOSHKvTOvwTwkfqDIKqiX7KEg+YdoXMs+lpUbG2+41Rayi5l0Jkzd6QZ4x3EYhKVFxCfdYNGpQ3tw3EV5MWrtDr/Gs3bCvo9xH0o0ddax6xIIw/G6DWJ3KISxNgG1API1qYT4LVF48nXRrr+PH6EdYES1LzsiPC6t9kk4YfhV+bS3gO076JgEilfvGVY3v4HPMIw2Yc0AB/hTsvbjEc0cAoQIsJL3+OlzjivroPgKvzYHrdgiaEv8iPVOZiNrEmiqT0="
